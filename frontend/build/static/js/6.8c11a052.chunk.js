(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[6],{231:function(e,t){},233:function(e,t){},259:function(e,t,n){"use strict";n.r(t);var c=n(30),o=n(31),r=n(43),a=n(42),s=n(0),i=n(16),l=n(29),u=n(71),d=n(32),j=n(75),b=n(175),g=n(180),h=n(143),m=n(178),p=n(255),O=n(257),f=n(256),x=n(100),v=n(179),k=n(10),D=n(207),w=n.n(D),y=n(56),I=n(34),N=n(243),R=n.n(N),S=n(244),C=n.n(S),B=n(245),T=n.n(B),A=n(246),F=n.n(A),V=n(248),M=n.n(V),_=n(247),E=n.n(_),U=n(242),z=n.n(U),J=n(241),H=n.n(J),L=n(2),P=Object(b.a)((function(e){var t;return{video:{width:"100%",height:"100%",backgroundSize:"cover",objectFit:"fill",zIndex:-1,overflow:"hidden"},gridContainer:Object(j.a)({justifyContent:"center"},e.breakpoints.down("md"),{flexDirection:"column"}),paper:Object(j.a)({display:"grid",justifyContent:"space-around",gridAutoFlow:"column",overflow:"hidden",height:"100%",width:"100%",boxShadow:"none"},e.breakpoints.down("sm"),{gridAutoFlow:"row"}),userDetailDiv:{position:"absolute"},userDiv:{textAlign:"center",position:"relative",padding:e.spacing(1),margin:e.spacing(1)},chatRoom:{height:"100%"},chatRoomMainDiv:{display:"grid",gridAutoFlow:"column",width:"100%",height:"100%",position:"relative"},chatBox:Object(j.a)({position:"relative",backgroundColor:e.palette.secondary.main,zIndex:2,width:"auto",minWidth:"30vh",maxHeight:"100%"},e.breakpoints.down("xs"),{position:"absolute",top:0,bottom:0,right:0,left:0,width:"100%",height:"100%"}),chatBoxIntro:{padding:"2px"},chatBoxMessages:{padding:"2px"},actionButtons:(t={position:"absolute",bottom:"2rem",display:"grid",justifyContent:"center",boxShadow:"none",gridAutoFlow:"column",marginLeft:"auto",marginRight:"auto"},Object(j.a)(t,e.breakpoints.up("md"),{right:0,left:0}),Object(j.a)(t,e.breakpoints.down("xs"),{gridAutoFlow:"row"}),t),textfield:{position:"absolute",bottom:"0px",width:"100%",backgroundColor:e.palette.primary.main}}})),W={},q=Object(k.h)(Object(i.b)((function(e){return{myuser:e.auth.user,currentRoom:e.room.currentRoom,token:e.auth.token}}),(function(e){return{updateRoomUsers:function(t,n,c){return e(Object(y.c)(t,n,c))}}}))((function(e){var t=Object(k.g)(),n=(Object(i.c)((function(e){return e.room.currentRoom})),Object(s.useState)()),c=Object(d.a)(n,2),o=c[0],r=c[1],a=(Object(i.c)((function(e){return e.auth.token})),Object(s.useState)([])),l=Object(d.a)(a,2),j=l[0],b=l[1],D=Object(s.useState)([]),y=Object(d.a)(D,2),N=y[0],S=y[1],B=Object(s.useState)([]),A=Object(d.a)(B,2),V=(A[0],A[1]),_=(Object(s.useRef)(),Object(s.useRef)()),U=(Object(s.useRef)(),Object(s.useRef)()),J=Object(s.useState)(),q=Object(d.a)(J,2),G=q[0],K=q[1],Q=Object(s.useState)(!0),X=Object(d.a)(Q,2),Y=X[0],Z=X[1],$=Object(s.useState)(!1),ee=Object(d.a)($,2),te=ee[0],ne=ee[1],ce=Object(s.useState)(!1),oe=Object(d.a)(ce,2),re=oe[0],ae=oe[1],se=Object(s.useState)(!1),ie=Object(d.a)(se,2),le=ie[0],ue=ie[1],de=Object(s.useRef)([]),je=P();function be(){ne(!te)}return Object(s.useEffect)((function(){console.log(t),console.log(e);var n={id:e.match.params.id,sharing_id:e.match.params.code};return n=JSON.stringify(n),e.updateRoomUsers(n,e.match.params.id,(function(){ue(!0)})),function(){U.current.getTracks().map((function(e){e.stop()})),U.current.getTracks()[0].stop(),I.a.close()}}),[]),Object(s.useEffect)((function(){le&&(console.log(e.currentRoom),Boolean(I.a)&&I.a.socketRef&&I.a.close(),I.a.connect("ws://localhost:8000/ws/chat/".concat(e.currentRoom.sharing_id)),I.a.waitForSocketConnection((function(){console.log("looping")})),V(I.a),navigator.mediaDevices.getUserMedia({video:W,audio:!0}).then((function(t){U.current=t,K(t),I.a.sendSignal("join room",""),I.a.on("all users",(function(n){console.log("all users received"),console.log(n);var c=[];n.forEach((function(n){if(n[0]!==e.myuser.pk){var o=function(e,t,n){var c=new w.a({initiator:!0,trickle:!1,stream:n});return c.on("signal",(function(n){I.a.sendSignal("sending signal",{userToSignal:e,callerID:t,signal:n})})),c}(n[0],e.myuser.pk,t);de.current.push({peerID:n[0],peerName:n[1],peer:o}),c.push({peerID:n[0],peerName:n[1],peer:o}),console.log("created peer "+n.id)}})),b(c),console.log("peers after all users"),console.log(c)})),I.a.on("user joined",(function(n){if(console.log("user joined"),console.log(j),console.log(n.userID),n.userID===e.myuser.pk){var c=function(e,t,n){var c=new w.a({initiator:!1,trickle:!1,stream:n}),o=t[0];return c.on("signal",(function(e){I.a.sendSignal("returning signal",{signal:e,callerID:o})})),c.signal(e),c}(n.signal,n.caller,t);if(!Boolean(de.current.some((function(e){return e.peerID==n.caller[0]})))){de.current.push({peerID:n.caller[0],peerName:n.caller[1],peer:c});var o={peerID:n.callerID,peerName:n.caller[1],peer:c};b((function(e){return[].concat(Object(u.a)(e),[o])})),console.log("added peer "+o.peerID)}console.log(j)}})),I.a.on("receiving returned signal",(function(t){(console.log("receiving returned signal"),t.userID===e.myuser.pk)&&de.current.find((function(e){return e.peerID===t.id})).peer.signal(t.signal)})),I.a.on("user left",(function(e){console.log("user left");var t=de.current.find((function(t){return t.peerID===e}));t&&t.peer.destroy();var n=de.current.filter((function(t){return t.peerID!==e}));de.current=n,b(n)})),I.a.on("message received",(function(e){var t={user:e.user,msg:e.message};S((function(e){return[].concat(Object(u.a)(e),[t])})),console.log(N)}))})))}),[le]),le?Object(L.jsxs)("div",{className:je.chatRoom,children:[Object(L.jsxs)("div",{className:je.chatRoomMainDiv,children:[Object(L.jsxs)(g.a,{container:!0,spacing:2,className:je.paper,children:[Object(L.jsx)(g.a,{container:!0,item:!0,xs:12,className:je.userDiv,children:Object(L.jsx)(h.a,{children:Object(L.jsx)(m.a,{variant:"h5",className:je.userDetailDiv,gutterBottom:!0,children:e.myuser.first_name})})},e.myuser.pk),Object(L.jsx)(g.a,{container:!0,item:!0,xs:12,className:je.userDiv,children:Object(L.jsx)(h.a,{children:Object(L.jsx)(m.a,{variant:"h5",className:je.userDetailDiv,gutterBottom:!0,children:e.myuser.first_name})})},e.myuser.pk-2),j.map((function(e){return Object(L.jsx)(g.a,{container:!0,xs:12,item:!0,className:je.userDiv,children:Object(L.jsx)(h.a,{children:Object(L.jsx)(m.a,{variant:"h5",className:je.userDetailDiv,gutterBottom:!0,children:e.peerName})})},e.peerID)}))]}),te?Object(L.jsxs)(g.a,{xs:6,className:je.chatBox,children:[Object(L.jsx)(g.a,{className:je.chatBoxIntro,children:Object(L.jsx)(p.a,{children:Object(L.jsx)(H.a,{onClick:be})})}),Object(L.jsx)(g.a,{className:je.chatBoxMessages,children:N.map((function(e){return Object(L.jsxs)("div",{children:[Object(L.jsx)("div",{children:e.user}),Object(L.jsx)("div",{children:e.msg})]})}))}),Object(L.jsx)(g.a,{className:je.chatBoxInput,children:Object(L.jsx)(O.a,{color:"secondary",className:je.textfield,onChange:function(e){r(e.target.value)},value:o,name:"message",variant:"outlined",autoComplete:!1,label:"",placeholder:"Enter your msg",InputProps:{endAdornment:Object(L.jsx)(f.a,{position:"end",children:Object(L.jsx)(p.a,{children:Object(L.jsx)(x.a,{onClick:function(){I.a.sendSignal("send_message",o),r("")},children:Object(L.jsx)(z.a,{})})})})}})})]}):""]}),Object(L.jsxs)(g.a,{className:je.actionButtons,children:[Object(L.jsx)(v.a,{onClick:function(){G.getVideoTracks()[0].enabled=!G.getVideoTracks()[0].enabled,Z(!Y)},children:Y?Object(L.jsx)(R.a,{}):Object(L.jsx)(C.a,{})}),Object(L.jsx)(v.a,{onClick:function(){G.getAudioTracks()[0].enabled=!G.getAudioTracks()[0].enabled,ae(!re)},children:re?Object(L.jsx)(T.a,{}):Object(L.jsx)(F.a,{})}),Object(L.jsx)(v.a,{onClick:be,children:Object(L.jsx)(E.a,{})}),Object(L.jsx)(v.a,{onClick:function(){console.log(G),(G&&G.getTracks()).map((function(e){e.stop()})),t.push("/")},children:Object(L.jsx)(M.a,{})}),Object(L.jsx)(v.a,{onClick:function(){console.log(G),console.log(de.current),navigator.mediaDevices.getDisplayMedia({cursor:!0}).then((function(e){console.log(e.getVideoTracks()),de.current[0].peer.replaceTrack(de.current[0].peer.streams[0].getVideoTracks()[0],e.getVideoTracks()[0],de.current[0].peer.streams[0]),_.current.srcObject=e}))},children:Object(L.jsx)(E.a,{})})]})]}):Object(L.jsx)("div",{children:"Room doesnt exist"})}))),G=function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){return Object(L.jsx)("div",{style:{height:"90vh"},className:"VideoView",children:Object(L.jsx)(q,{})})}}]),n}(s.Component);t.default=Object(i.b)((function(e){return{user:e.auth.user}}),(function(e){return{logoutUser:function(){return e(Object(l.c)())}}}))(G)}}]);
//# sourceMappingURL=6.8c11a052.chunk.js.map