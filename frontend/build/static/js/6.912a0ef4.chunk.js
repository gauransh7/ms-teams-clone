(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[6],{239:function(e,t){},241:function(e,t){},267:function(e,t,n){"use strict";n.r(t);var o=n(30),c=n(31),i=n(42),r=n(41),a=n(0),s=n.n(a),l=n(16),u=n(29),d=n(70),j=n(32),b=n(74),g=n(181),h=n(185),m=n(186),O=n(184),p=n(263),f=n(265),v=n(264),x=n(101),w=n(10),y=n(215),k=n.n(y),D=n(55),S=n(256),I=n(35),N=n(251),C=n.n(N),R=n(252),_=n.n(R),B=n(210),M=n.n(B),q=n(211),A=n.n(q),T=n(254),H=n.n(T),W=n(253),E=n.n(W),F=n(250),V=n.n(F),z=n(249),J=n.n(z),P=n(255),U=n.n(P),L=n(149),G=n(150),K=n(2),Q=Object(G.a)((function(e){return{videoOffDiv:{overflow:"hidden",objectFit:"fill",backgroundSize:"cover",backgroundColor:e.palette.secondary.main,display:"grid",alignItems:"center",justifyItems:"center"}}})),X=function(e){Object(w.g)();var t=Q(),n=e.dimension/Math.sqrt(1+e.numpeers);return Object(K.jsx)(L.a,{className:t.videoOffDiv,style:{width:n,height:n,display:e.video?"none":""},children:Object(K.jsxs)("div",{children:[Object(K.jsx)(O.a,{variant:"h5",children:e.name}),e.audio?Object(K.jsx)(M.a,{}):Object(K.jsx)(A.a,{})]})})},Y=Object(g.a)((function(e){var t;return{video:{backgroundSize:"cover",objectFit:"fill",overflow:"hidden"},gridContainer:Object(b.a)({justifyContent:"center"},e.breakpoints.down("md"),{flexDirection:"column"}),paper:Object(b.a)({display:"grid",justifyContent:"space-around",gridAutoFlow:"column",overflow:"hidden",height:"100%",width:"100%",boxShadow:"none"},e.breakpoints.down("sm"),{gridAutoFlow:"row"}),userDetailDiv:{position:"absolute"},userDiv:{textAlign:"center",position:"relative",padding:e.spacing(1),margin:e.spacing(1)},chatRoom:{height:"100%"},chatRoomMainDiv:{display:"grid",gridAutoFlow:"column",width:"100%",height:"100%",position:"relative"},chatBox:Object(b.a)({position:"relative",backgroundColor:e.palette.secondary.main,zIndex:2,width:"auto",minWidth:"30vh",maxHeight:"100%"},e.breakpoints.down("xs"),{position:"absolute",top:0,bottom:0,right:0,left:0,width:"100%",height:"100%"}),chatBoxIntro:{padding:"2px"},chatBoxMessages:{padding:"2px"},actionButtons:(t={position:"absolute",bottom:"2rem",display:"grid",justifyContent:"center",boxShadow:"none",gridAutoFlow:"column",marginLeft:"auto",marginRight:"auto"},Object(b.a)(t,e.breakpoints.up("md"),{right:0,left:0}),Object(b.a)(t,e.breakpoints.down("xs"),{gridAutoFlow:"row"}),t),textfield:{position:"absolute",bottom:"0px",width:"100%",backgroundColor:e.palette.primary.main}}})),Z=function(e){console.log(e.peer);var t=Object(a.useRef)(),n=Y(),o=Math.sqrt(window.screen.availWidth*window.screen.availHeight)/1.4;return Object(a.useEffect)((function(){console.log("video started"),e.peer.on("stream",(function(e){console.log(e),t.current.srcObject=e}))}),[]),Object(K.jsx)("video",{playsInline:!0,width:o/Math.sqrt(1+e.numpeers),height:o/Math.sqrt(1+e.numpeers),autoPlay:!0,style:{display:e.video?"block":"none"},className:n.video,ref:t})},$={height:window.screen.availHeight,width:window.screen.availWidth},ee=s.a.memo((function(e){var t=Object(w.g)(),n=Object(l.c)((function(e){return e.room.currentRoom})),o=Object(a.useState)(!0),c=Object(j.a)(o,2),i=c[0],r=c[1],s=Object(a.useState)(!1),u=Object(j.a)(s,2),b=u[0],g=u[1],y=Object(a.useState)(),D=Object(j.a)(y,2),N=D[0],R=D[1],B=(Object(l.c)((function(e){return e.auth.token})),Object(a.useState)([])),q=Object(j.a)(B,2),T=q[0],W=q[1],F=Object(a.useState)([]),z=Object(j.a)(F,2),P=(z[0],z[1],Object(a.useState)([])),L=Object(j.a)(P,2),G=L[0],Q=L[1],ee=Object(a.useState)([]),te=Object(j.a)(ee,2),ne=(te[0],te[1]),oe=(Object(a.useRef)(),Object(a.useState)(window.screen.availHeight)),ce=Object(j.a)(oe,2),ie=ce[0],re=ce[1],ae=Object(a.useRef)(),se=Object(a.useRef)(),le=Object(a.useState)(),ue=Object(j.a)(le,2),de=ue[0],je=ue[1],be=Object(a.useState)(!0),ge=Object(j.a)(be,2),he=ge[0],me=ge[1],Oe=Object(a.useState)(!1),pe=Object(j.a)(Oe,2),fe=pe[0],ve=pe[1],xe=Object(a.useState)(!0),we=Object(j.a)(xe,2),ye=we[0],ke=we[1],De=Object(a.useState)(!1),Se=Object(j.a)(De,2),Ie=Se[0],Ne=Se[1],Ce=Object(a.useRef)([]),Re=Y();function _e(){ve(!fe)}function Be(){se.current.getVideoTracks()[0].enabled=!se.current.getVideoTracks()[0].enabled,i?me(!he):I.a.sendSignal("toggle video")}function Me(){se.current.getAudioTracks()[0].enabled=!se.current.getAudioTracks()[0].enabled,i?ke(!ye):I.a.sendSignal("toggle audio")}return Object(a.useEffect)((function(){console.log("initialize");var e=Math.sqrt(window.screen.availHeight*window.screen.availWidth)/1.4;return re(e),function(){se.current.getTracks().map((function(e){e.stop()})),se.current.getTracks()[1].stop(),I.a.close()}}),[]),Object(a.useEffect)((function(){console.log("peers changed"),console.log(T)}),[T]),Object(a.useEffect)((function(){var t={id:e.match.params.id,sharing_id:e.match.params.code};t=JSON.stringify(t),e.getRoomDetails(t,e.match.params.id,(function(){console.log(n&&n.created_by==e.myuser.pk),n&&n.created_by==e.myuser.pk&&(navigator.mediaDevices.getUserMedia({video:{videoConstraints:$},audio:!0}).then((function(e){console.log(e),ae.current.srcObject=e,se.current=e,je(e)})).catch((function(e){console.log(e),S.b.error("Cannot get access to your camera and video !")})),console.log("admin hai ye"),r(!1)),Ne(!0)}))}),[n.id]),Object(a.useEffect)((function(){Ie&&(i?navigator.mediaDevices.getUserMedia({video:{videoConstraints:$},audio:!0}).then((function(e){console.log(e),ae.current.srcObject=e,se.current=e,je(e)})).catch((function(e){console.log(e),S.b.error("Cannot get access to your camera and video !")})):(Boolean(I.a)&&I.a.socketRef&&I.a.close(),I.a.connect("".concat("http:"==window.location.protocol?"ws":"wss","://").concat(window.location.host.includes("localhost:")?"localhost:8000":window.location.hostname,"/ws/chat/").concat(e.currentRoom.sharing_id)),ne(I.a),I.a.sendSignal("join room",{video:he,audio:ye}),I.a.on("request invite",(function(t){var o=-1!=e.currentRoom.all_users.indexOf(t.id);console.log(e.currentRoom.all_users),console.log(t.id==e.currentRoom.created_by),console.log(t.id==e.currentRoom.created_by||o),t.id==e.currentRoom.created_by||o?I.a.sendSignal("accept invite",t.id):e.currentRoom.created_by==e.myuser.pk&&n.created_by!=t.id&&Object(S.b)((function(e){return Object(K.jsxs)("div",{children:[t.email," wants to join"," ",Object(K.jsx)(h.a,{color:"inherit",onClick:function(){return n=e.id,o=t.id,I.a.sendSignal("accept invite",o),void S.b.dismiss(n);var n,o},children:"accept"}),Object(K.jsx)(h.a,{color:"inherit",onClick:function(){return n=e.id,o=t.id,I.a.sendSignal("reject invite",o),void S.b.dismiss(n);var n,o},children:"Decline"})]})}),{icon:"\ud83d\udc64",duration:1e5})})),I.a.on("invite was rejected",(function(n){console.log(e.myuser.pk==n.id),e.myuser.pk==n.id&&(alert("Admin rejected your request"),t.push("/"))})),I.a.on("all users",(function(t){if(1==b&&(console.log("pending req was true"),g(!1),ae.current.srcObject=se.current),t.id==e.myuser.pk){console.log("all users received"),console.log(t.users);var n=[];t.users.forEach((function(t){if(t[0]!==e.myuser.pk&&!Boolean(Ce.current.some((function(e){return e.peerID==t[0]})))){console.log(se.current);var o=function(e,t,n){var o=new k.a({initiator:!0,trickle:!1,stream:n});return o.on("signal",(function(n){I.a.sendSignal("sending signal",{userToSignal:e,callerID:t,signal:n})})),o}(t[0],e.myuser.pk,se.current);Ce.current.push({peerID:t[0],peerName:t[1],video:t[2],audio:t[3],peer:o}),n.push({peerID:t[0],peerName:t[1],video:t[2],audio:t[3],peer:o}),console.log("created peer "+t[1])}})),W(n),console.log("peers after all users"),console.log(T)}})),I.a.on("user joined",(function(t){if(console.log(t.userID),t.userID===e.myuser.pk){if(!Boolean(Ce.current.some((function(e){return e.peerID==t.caller[0]})))){var n=function(e,t,n){var o=new k.a({initiator:!1,trickle:!1,stream:n}),c=t[0];return o.on("signal",(function(e){I.a.sendSignal("returning signal",{signal:e,callerID:c})})),o.signal(e),o}(t.signal,t.caller,se.current);Object(S.b)("".concat(t.caller[1]," joined the room."),{icon:"\ud83d\udc4f"}),console.log("".concat(t.caller[1]," joined the room.")),Ce.current.push({peerID:t.caller[0],peerName:t.caller[1],video:t.caller[2],audio:t.caller[3],peer:n});var o={peerID:t.caller[0],peerName:t.caller[1],video:t.caller[2],audio:t.caller[3],peer:n};W([].concat(Object(d.a)(T),[o])),console.log("added peer")}console.log(T)}})),I.a.on("receiving returned signal",(function(t){(console.log("receiving returned signal"),t.userID===e.myuser.pk)&&Ce.current.find((function(e){return e.peerID===t.id})).peer.signal(t.signal);console.log(T)})),I.a.on("user left",(function(e){var t=Ce.current.find((function(t){return t.peerID===e}));t&&(Object(S.b)("".concat(t.peerName," left."),{icon:"\u2139\ufe0f"}),t.peer.destroy());var n=Ce.current.filter((function(t){return t.peerID!==e}));Ce.current=n,W(n)})),I.a.on("message received",(function(t){var n={user:t.user,msg:t.message};Q((function(e){return[].concat(Object(d.a)(e),[n])})),e.myuser.first_name==n.user||fe||Object(S.b)("".concat(t.user," : ").concat(t.message),{icon:"\ud83d\udcac"}),console.log(G)})),I.a.on("toggle video",(function(t){if(t.id==e.myuser.pk)me(t.value);else{var n=Ce.current;for(var o in n)if(n[o].peerID==t.id){n[o].video=t.value;break}W(Object(d.a)(n)),Ce.current=n}})),I.a.on("toggle audio",(function(t){if(t.id==e.myuser.pk)ke(t.value);else{var n=Ce.current;for(var o in n)if(n[o].peerID==t.id){n[o].audio=t.value;break}W(Object(d.a)(n)),Ce.current=n}}))))}),[Ie,i]),console.log(b),console.log(i),console.log(T),Ie?i||b?Object(K.jsxs)("div",{children:[Object(K.jsx)(O.a,{variant:"h5",className:Re.userDetailDiv,gutterBottom:!0,children:e.myuser.first_name}),Object(K.jsx)("video",{width:0==T.length||window.screen.availWidth<1400?window.screen.availWidth/1.3:window.screen.availWidth/2.2,height:0==T.length?window.screen.availHeight/1.3:window.screen.availWidth<1400?window.screen.availHeight/2.3:window.screen.availHeight/1.3,playsInline:!0,muted:!0,autoPlay:!0,className:Re.video,ref:ae}),Object(K.jsx)(h.a,{onClick:Be,children:he?Object(K.jsx)(C.a,{}):Object(K.jsx)(_.a,{})}),Object(K.jsx)(h.a,{onClick:Me,children:ye?Object(K.jsx)(M.a,{}):Object(K.jsx)(A.a,{})}),Object(K.jsx)(h.a,{onClick:function(){console.log("joining room"),g(!0),r(!1)},disabled:b,children:"Join room"})]}):Object(K.jsxs)("div",{className:Re.chatRoom,children:[Object(K.jsx)(S.a,{}),Object(K.jsxs)("div",{className:Re.chatRoomMainDiv,children:[Object(K.jsxs)(m.a,{container:!0,spacing:2,className:Re.paper,children:[Object(K.jsxs)(m.a,{container:!0,item:!0,xs:12,className:Re.userDiv,children:[Object(K.jsx)(O.a,{variant:"h5",className:Re.userDetailDiv,style:{display:he?"block":"none"},gutterBottom:!0,children:e.myuser.first_name}),Object(K.jsx)("video",{width:ie/Math.sqrt(1+Ce.current.length),height:ie/Math.sqrt(1+Ce.current.length),playsInline:!0,muted:!0,style:{display:he?"block":"none"},autoPlay:!0,className:Re.video,ref:ae}),Object(K.jsx)(X,{name:e.myuser.first_name,audio:ye,video:he,dimension:ie,numpeers:Ce.current.length})]},e.myuser.pk),Ce.current.map((function(e){return console.log(e),Object(K.jsxs)(m.a,{xs:12,item:!0,className:Re.userDiv,children:[Object(K.jsx)(O.a,{variant:"h5",className:Re.userDetailDiv,gutterBottom:!0,style:{display:e.video?"block":"none"},children:e.peerName}),Object(K.jsx)(Z,{peer:e.peer,video:e.video,numpeers:Ce.current.length}),Object(K.jsx)(X,{name:e.peerName,audio:e.audio,video:e.video,dimension:ie,numpeers:Ce.current.length})]},e.peerID)}))]}),fe?Object(K.jsxs)(m.a,{className:Re.chatBox,children:[Object(K.jsx)(m.a,{className:Re.chatBoxIntro,children:Object(K.jsx)(p.a,{children:Object(K.jsx)(J.a,{onClick:_e})})}),Object(K.jsx)(m.a,{className:Re.chatBoxMessages,children:G.map((function(e){return Object(K.jsxs)("div",{children:[Object(K.jsx)("div",{children:e.user}),Object(K.jsx)("div",{children:e.msg})]})}))}),Object(K.jsx)(m.a,{className:Re.chatBoxInput,children:Object(K.jsx)(f.a,{color:"secondary",className:Re.textfield,onChange:function(e){R(e.target.value)},value:N,name:"message",variant:"outlined",autoComplete:!1,label:"",placeholder:"Enter your msg",InputProps:{endAdornment:Object(K.jsx)(v.a,{position:"end",children:Object(K.jsx)(p.a,{children:Object(K.jsx)(x.a,{onClick:function(){I.a.sendSignal("send_message",N),R("")},children:Object(K.jsx)(V.a,{})})})})}})})]}):""]}),Object(K.jsxs)(m.a,{className:Re.actionButtons,children:[Object(K.jsx)(h.a,{onClick:Be,children:he?Object(K.jsx)(C.a,{}):Object(K.jsx)(_.a,{})}),Object(K.jsx)(h.a,{onClick:Me,children:ye?Object(K.jsx)(M.a,{}):Object(K.jsx)(A.a,{})}),Object(K.jsx)(h.a,{onClick:_e,children:Object(K.jsx)(E.a,{})}),Object(K.jsx)(h.a,{onClick:function(){console.log(de),(de&&de.getTracks()).map((function(e){e.stop()})),t.push("/")},children:Object(K.jsx)(H.a,{})}),Object(K.jsx)(h.a,{onClick:function(){console.log(de),console.log(Ce.current[0].peer),navigator.mediaDevices.getDisplayMedia({video:{cursor:"always"},audio:"true"}).then((function(e){console.log(e.getVideoTracks());e.getVideoTracks()[0];ae.current.srcObject=e}))},children:Object(K.jsx)(U.a,{})})]})]}):Object(K.jsx)("div",{children:"Room doesnt exist"})})),te=Object(w.h)(Object(l.b)((function(e){return{myuser:e.auth.user,currentRoom:e.room.currentRoom,token:e.auth.token}}),(function(e){return{getRoomDetails:function(t,n,o){return e(Object(D.c)(t,n,o))}}}))(ee)),ne=function(e){Object(i.a)(n,e);var t=Object(r.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return Object(K.jsx)("div",{style:{height:"90vh"},className:"VideoView",children:Object(K.jsx)(te,{})})}}]),n}(a.Component);t.default=Object(l.b)((function(e){return{user:e.auth.user}}),(function(e){return{logoutUser:function(){return e(Object(u.c)())}}}))(ne)}}]);
//# sourceMappingURL=6.912a0ef4.chunk.js.map